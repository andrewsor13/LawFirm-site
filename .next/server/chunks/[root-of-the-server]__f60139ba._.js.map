{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/andreisorin/Desktop/ProjectsInProgress/LawFirm-site/src/lib/prisma.tsx"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log:\n      process.env.NODE_ENV === \"development\"\n        ? [\"query\", \"error\", \"warn\"]\n        : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n\nprocess.on(\"beforeExit\", async () => {\n  await prisma.$disconnect();\n});\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6HAAA,CAAA,eAAY,CAAC;IACf,KACE,uCACI;QAAC;QAAS;QAAS;KAAO;AAElC;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B;AAEA,QAAQ,EAAE,CAAC,cAAc;IACvB,MAAM,OAAO,WAAW;AAC1B","debugId":null}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///Users/andreisorin/Desktop/ProjectsInProgress/LawFirm-site/src/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\nimport { prisma } from \"./prisma\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nconst supabaseAdmin = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\nfunction sanitizeFileName(name: string) {\n  return name\n    .normalize(\"NFD\") // separÄƒ diacriticele\n    .replace(/[\\u0300-\\u036f]/g, \"\") // eliminÄƒ diacriticele\n    .replace(/\\s+/g, \"_\") // spaÈ›ii -> _\n    .replace(/[^a-zA-Z0-9._-]/g, \"\"); // eliminÄƒ caractere interzise\n}\n\nexport async function uploadFile(file: File, id: number) {\n  const safeName = sanitizeFileName(file.name);\n  const filePath = `clients/${id}/${safeName}`;\n\n  const blob = new Blob([await file.arrayBuffer()], { type: file.type });\n\n  const { data, error } = await supabase.storage\n    .from(\"documents\")\n    .upload(filePath, blob, { upsert: true });\n\n  if (error) {\n    console.error(\"Upload error:\", error);\n    return { success: false, error };\n  }\n\n  const publicUrl = supabase.storage.from(\"documents\").getPublicUrl(filePath)\n    .data.publicUrl;\n\n  await prisma.documents.create({\n    data: {\n      fileName: file.name,\n      fileLink: publicUrl,\n      clientId: id,\n    },\n  });\n\n  return { success: true, data };\n}\n\nexport async function uploadImageLawyer(file: File, lawyerId: number) {\n  const safeName = file.name.replace(/\\s+/g, \"_\");\n  const filePath = `lawyers/${lawyerId}/${safeName}`;\n\n  const blob = new Blob([await file.arrayBuffer()], { type: file.type });\n\n  const { error } = await supabaseAdmin.storage\n    .from(\"images\")\n    .upload(filePath, blob, { upsert: true });\n\n  if (error) {\n    console.error(\"Upload error:\", error);\n    return { success: false, error };\n  }\n\n  const { data } = supabaseAdmin.storage.from(\"images\").getPublicUrl(filePath);\n\n  return { success: true, url: data.publicUrl, fileName: safeName };\n}\n\nexport async function deleteImageLawyer(filePath: string) {\n  if (!filePath) return;\n\n  try {\n    console.log(\"È˜terg din bucket:\", filePath);\n\n    const { error } = await supabaseAdmin.storage\n      .from(\"images\")\n      .remove([filePath]);\n\n    if (error) {\n      console.error(\"Eroare la È™tergere imagine:\", error.message);\n    } else {\n      console.log(\"âœ… Imagine È™tearsÄƒ cu succes!\");\n    }\n  } catch (err) {\n    console.error(\"Eroare la deleteImageLawyer:\", err);\n  }\n}\n\nexport async function uploadSiteImage(file: File, folderName: string) {\n  const safeName = file.name.replace(/\\s+/g, \"_\");\n  const filePath = `siteImages/${folderName}/${safeName}`;\n\n  const blob = new Blob([await file.arrayBuffer()], { type: file.type });\n\n  const { error } = await supabaseAdmin.storage\n    .from(\"images\")\n    .upload(filePath, blob, { upsert: true });\n\n  if (error) {\n    console.error(\"Upload error:\", error);\n    return { success: false, error };\n  }\n\n  const { data } = supabaseAdmin.storage.from(\"images\").getPublicUrl(filePath);\n\n  return { success: true, url: data.publicUrl };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 330, "column": 0}, "map": {"version":3,"sources":["file:///Users/andreisorin/Desktop/ProjectsInProgress/LawFirm-site/src/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\n\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false,\n  },\n});\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEzD,MAAM,gBAAgB,CAAA,GAAA,yLAAA,CAAA,eAAY,AAAD,EAAE,aAAa,oBAAoB;IACzE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF","debugId":null}},
    {"offset": {"line": 349, "column": 0}, "map": {"version":3,"sources":["file:///Users/andreisorin/Desktop/ProjectsInProgress/LawFirm-site/src/lib/auth.ts"],"sourcesContent":["import CredentialsProvider from \"next-auth/providers/credentials\";\nimport { supabaseAdmin } from \"./supabaseAdmin\";\nimport { NextAuthOptions, DefaultSession } from \"next-auth\";\nimport { compare } from \"bcryptjs\";\n\ndeclare module \"next-auth\" {\n  interface Session {\n    user: {\n      id: string;\n      role: string;\n    } & DefaultSession[\"user\"];\n  }\n\n  interface JWT {\n    id: string;\n    role: string;\n  }\n}\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials) {\n        if (!credentials) return null;\n\n        const email = credentials.email.toLowerCase();\n        const password = credentials.password;\n\n        console.log(\"ðŸ”‘ Login attempt:\", { email, password });\n\n        const { data, error } = await supabaseAdmin\n          .from(\"admin_users\")\n          .select(\"*\")\n          .eq(\"email\", email)\n          .single();\n\n        console.log(\"ðŸ—‚ Supabase result:\", { data, error });\n\n        if (error || !data) {\n          console.log(\"âŒ User not found in DB\");\n          return null;\n        }\n\n        const isValid = await compare(password, data.password);\n        console.log(\"ðŸ” Compare result:\", isValid);\n\n        if (!isValid) {\n          console.log(\"âŒ Invalid password for user:\", data.email);\n          return null;\n        }\n\n        console.log(\"âœ… Authorized user:\", data.email);\n        return {\n          id: data.id,\n          email: data.email,\n          role: data.role,\n          name: data.name,\n        };\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id;\n        token.role = user.role;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      if (token?.id) {\n        session.user.id = token.id;\n        session.user.role = token.role;\n      }\n      return session;\n    },\n\n    redirect: async ({ url, baseUrl }) => {\n      if (url.startsWith(baseUrl)) return url;\n      if (url.startsWith(\"/\")) return `${baseUrl}${url}`;\n      return baseUrl;\n    },\n  },\n  pages: {\n    signIn: \"/login\",\n  },\n  session: {\n    strategy: \"jwt\",\n  },\n};\n"],"names":[],"mappings":";;;AAAA;AACA;AAEA;;;;AAgBO,MAAM,cAA+B;IAC1C,WAAW;QACT,CAAA,GAAA,0JAAA,CAAA,UAAmB,AAAD,EAAE;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,OAAO;gBAEzB,MAAM,QAAQ,YAAY,KAAK,CAAC,WAAW;gBAC3C,MAAM,WAAW,YAAY,QAAQ;gBAErC,QAAQ,GAAG,CAAC,qBAAqB;oBAAE;oBAAO;gBAAS;gBAEnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAA,CAAA,gBAAa,CACxC,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,SAAS,OACZ,MAAM;gBAET,QAAQ,GAAG,CAAC,uBAAuB;oBAAE;oBAAM;gBAAM;gBAEjD,IAAI,SAAS,CAAC,MAAM;oBAClB,QAAQ,GAAG,CAAC;oBACZ,OAAO;gBACT;gBAEA,MAAM,UAAU,MAAM,CAAA,GAAA,mIAAA,CAAA,UAAO,AAAD,EAAE,UAAU,KAAK,QAAQ;gBACrD,QAAQ,GAAG,CAAC,sBAAsB;gBAElC,IAAI,CAAC,SAAS;oBACZ,QAAQ,GAAG,CAAC,gCAAgC,KAAK,KAAK;oBACtD,OAAO;gBACT;gBAEA,QAAQ,GAAG,CAAC,sBAAsB,KAAK,KAAK;gBAC5C,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,OAAO,IAAI;gBACb,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YACA,OAAO;QACT;QAEA,UAAU,OAAO,EAAE,GAAG,EAAE,OAAO,EAAE;YAC/B,IAAI,IAAI,UAAU,CAAC,UAAU,OAAO;YACpC,IAAI,IAAI,UAAU,CAAC,MAAM,OAAO,GAAG,UAAU,KAAK;YAClD,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;IACA,SAAS;QACP,UAAU;IACZ;AACF","debugId":null}},
    {"offset": {"line": 439, "column": 0}, "map": {"version":3,"sources":["file:///Users/andreisorin/Desktop/ProjectsInProgress/LawFirm-site/src/app/api/clients/route.ts"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { uploadFile } from \"@/lib/supabaseClient\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport async function GET() {\n  const accounts = await prisma.clients.findMany({\n    orderBy: { createdAt: \"desc\" },\n    include: {\n      documents: true,\n    },\n  });\n\n  return NextResponse.json(accounts);\n}\n\nexport async function POST(req: NextRequest) {\n  const session = await getServerSession(authOptions);\n\n  if (!session) {\n    return NextResponse.json({ error: \"Neautorizat\" }, { status: 401 });\n  }\n\n  try {\n    const formData = await req.formData();\n\n    const name = formData.get(\"name\")?.toString() || \"\";\n    const email = formData.get(\"email\")?.toString() || \"\";\n    const phone = formData.get(\"phone\")?.toString() || \"\";\n    const message = formData.get(\"message\")?.toString() || \"\";\n\n    const client = await prisma.clients.create({\n      data: {\n        name: name,\n        email: email,\n        phone: phone,\n        message: message,\n      },\n    });\n    const clientId = client.id;\n\n    const files = formData.getAll(\"files\");\n    for (const file of files) {\n      if (file instanceof File) {\n        try {\n          const result = await uploadFile(file, clientId);\n\n          if (!result.success) {\n            console.error(\"Upload failed:\", result.error);\n            throw new Error(\"Upload to storage failed\");\n          }\n        } catch (error) {\n          console.error(\"Failed to upload file:\", error);\n        }\n      }\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error: unknown) {\n    if (error instanceof Error) {\n      console.error(error);\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    console.error(\"Unknown error\", error);\n    return NextResponse.json(\n      { error: \"Something went wrong\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,uHAAA,CAAA,SAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;QAC7C,SAAS;YAAE,WAAW;QAAO;QAC7B,SAAS;YACP,WAAW;QACb;IACF;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,UAAU,MAAM,CAAA,GAAA,uIAAA,CAAA,mBAAgB,AAAD,EAAE,oHAAA,CAAA,cAAW;IAElD,IAAI,CAAC,SAAS;QACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAc,GAAG;YAAE,QAAQ;QAAI;IACnE;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,IAAI,QAAQ;QAEnC,MAAM,OAAO,SAAS,GAAG,CAAC,SAAS,cAAc;QACjD,MAAM,QAAQ,SAAS,GAAG,CAAC,UAAU,cAAc;QACnD,MAAM,QAAQ,SAAS,GAAG,CAAC,UAAU,cAAc;QACnD,MAAM,UAAU,SAAS,GAAG,CAAC,YAAY,cAAc;QAEvD,MAAM,SAAS,MAAM,uHAAA,CAAA,SAAM,CAAC,OAAO,CAAC,MAAM,CAAC;YACzC,MAAM;gBACJ,MAAM;gBACN,OAAO;gBACP,OAAO;gBACP,SAAS;YACX;QACF;QACA,MAAM,WAAW,OAAO,EAAE;QAE1B,MAAM,QAAQ,SAAS,MAAM,CAAC;QAC9B,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,gBAAgB,MAAM;gBACxB,IAAI;oBACF,MAAM,SAAS,MAAM,CAAA,GAAA,8HAAA,CAAA,aAAU,AAAD,EAAE,MAAM;oBAEtC,IAAI,CAAC,OAAO,OAAO,EAAE;wBACnB,QAAQ,KAAK,CAAC,kBAAkB,OAAO,KAAK;wBAC5C,MAAM,IAAI,MAAM;oBAClB;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,0BAA0B;gBAC1C;YACF;QACF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAgB;QACvB,IAAI,iBAAiB,OAAO;YAC1B,QAAQ,KAAK,CAAC;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}